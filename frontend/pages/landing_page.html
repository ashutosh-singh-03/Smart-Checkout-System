<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Landing Page</title>
  <link rel="stylesheet" href="../css/landing_style.css">
  <script src="../js/config.js"></script>
</head>

<body>
  <header>
    <h2 class="logo">LOGO</h2>
    <nav class="navigation">
      <a href="#landing-page">Home</a>
      <a href="#features">Features</a>
      <a href="#subscription">Subscription</a>
      <button class="btnLogin-popup">Login</button>
    </nav>
  </header>


  <section id = 'landing-page'>
    <div class="wrapper">
        <span class = "icon-close"><ion-icon name="close-outline"></ion-icon></span>
        <div class = "form-box login">

        <h2>Login</h2>

        <div class="user-admin">
            <a href="#" class = "user-link"><ion-icon name = "person-add-outline"></ion-icon> User</a>
            <div class="vl"></div>
            <a href="#" class = "admin-link"><ion-icon name = "shield-checkmark-outline"></ion-icon> Admin</a>
        </div>

        <div class="form admin">
            <form onsubmit="loginUser('admin'); return false;">
            <div class="input-box">
                <span class = "icon"><ion-icon name="card-outline"></ion-icon></span>
                <input type="text" id="loginAdminEmployeeID" required>
                <label>Employee ID</label>
            </div>
            <div class="input-box">
                <span class = "icon"><ion-icon name="mail-open-outline"></ion-icon></span>
                <input type="email" id="loginAdminEmail" required>
                <label>Email</label>
            </div>
            <div class="input-box">
                <span class = "icon"><ion-icon name="lock-closed-outline"></ion-icon></span>
                <input type="password" id="loginAdminPassword" required>
                <label>Password</label>
            </div>
            <div class="remember-forgot">
                <label><input type="checkbox">Remember me</label>
                <a href="#">Forgot Password?</a>
            </div>
            <button type = "submit" class = "btn">Login</button>
            </form>
        </div>

        <div class="form user">
            <form onsubmit="loginUser('user'); return false;">
            <div class="input-box">
                <span class = "icon"><ion-icon name="mail-open-outline"></ion-icon></span>
                <input type="email" id="loginUserEmail" required>
                <label>Email</label>
            </div>
            <div class="input-box">
                <span class = "icon"><ion-icon name="lock-closed-outline"></ion-icon></span>
                <input type="password" id="loginUserPassword" required>
                <label>Password</label>
            </div>
            <div class="remember-forgot">
                <label><input type="checkbox">Remember me</label>
                <a href="#">Forgot Password?</a>
            </div>
            <button type = "submit" class = "btn">Login</button>
            <div class="login-register">
                <p>Don't have an account? <a href="#" class = "register-link">Register</a></p>
            </div>
            </form>
        </div>

        </div>

        <div class = "form-box register">
          <h2>Registration</h2>
          <form onsubmit="registerUser(); return false;">
              <div class="input-box">
              <span class = "icon"><ion-icon name="person-outline"></ion-icon></span>
              <input type="text" id="registerUsername" required>
              <label>Username</label>
              </div>
              <div class="input-box">
              <span class = "icon"><ion-icon name="mail-open-outline"></ion-icon></span>
              <input type="email" id="registerEmail" required>
              <label>Email</label>
              </div>
              <div class="input-box">
              <span class = "icon"><ion-icon name="lock-closed-outline"></ion-icon></span>
              <input type="password" id="registerPassword" required>
              <label>Password</label>
              </div>
              <div class="remember-forgot">
              <label><input type="checkbox" required>I agree to the terms & conditions</label>
              </div>
              <button type = "submit" class = "btn">Register</button>
              <div class="login-register">
              <p>Already have an account? <a href="#" class = "login-link">Login</a></p>
              </div>
          </form>
        </div>
    </div>

    <div id="loader-overlay">
      <div class="spinner"></div>
    </div>

    <div class="hero" id = 'text'>
      <h1>title</h1>
      <a href="#subscription" class="btnGetStarted-popup" style = "text-decoration: none;">Subscribe</a>    </div>
    <img src="../assets/images/cart.png" id = 'cart'>
  </section>

  
  <div class="container">
    <section id = 'features'>
      <h2>Service</h2>
      <div class="cards">
        <div class="card">
          <ion-icon name="diamond-outline"></ion-icon>
          <div class="content">
            <h3>Service 1</h3>
          </div>
        </div>
        <div class="card">
          <ion-icon name="diamond-outline"></ion-icon>
          <div class="content">
            <h3>Service 2</h3>
          </div>
        </div>
        <div class="card">
          <ion-icon name="diamond-outline"></ion-icon>
          <div class="content">
            <h3>Service 3</h3>
          </div>
        </div>
      </div>
    </section>

  <section id="subscription">
    <div class="overlay-top"></div>
    <div class="overlay-bottom"></div>
    <div class="card card-basic">
        <h1 class="card-title">Basic</h1>
        <div class="card-body">
            <div class="card-price">
                <p>$ <span class="card-price-value">5 </span><br>per month</p>
            </div>
            <div class="card-features">
                <ul>
                    <li>Feature 1</li>
                    <li>Feature 2</li>
                    <li>Feature 3</li>
                </ul>
            </div>
            <button class="card-btn">BUY NOW</button>
        </div>
    </div>

    <div class="card card-standard">
        <h1 class="card-title">Standard</h1>
        <div class="card-body">
            <div class="card-price">
                <p>$ <span class="card-price-value">25 </span><br>per month</p>
            </div>
            <div class="card-features">
                <ul>
                    <li>Feature 1</li>
                    <li>Feature 2</li>
                    <li>Feature 3</li>
                </ul>
            </div>
            <button class="card-btn">BUY NOW</button>
        </div>
    </div>

    <div class="card card-premium">
        <h1 class="card-title">Premium</h1>
        <div class="card-body">
            <div class="card-price">
                <p>$ <span class="card-price-value">55 </span><br>per month</p>
            </div>
            <div class="card-features">
                <ul>
                    <li>Feature 1</li>
                    <li>Feature 2</li>
                    <li>Feature 3</li>
                </ul>
            </div>
            <button class="card-btn">BUY NOW</button>
        </div>
    </div>
  </section>

    <footer id="footer">
        <div class="footer-container">

            <div class="footer-links">
            <a href="#landing-page">Home</a>
            <a href="#features">Features</a>
            <a href="#subscription">Subscription</a>
            <a href="#">Contact</a>
            </div>

            <div class="footer-social">
            <a href="#"><ion-icon name="logo-facebook"></ion-icon></a>
            <a href="#"><ion-icon name="logo-twitter"></ion-icon></a>
            <a href="#"><ion-icon name="logo-instagram"></ion-icon></a>
            <a href="#"><ion-icon name="logo-linkedin"></ion-icon></a>
            </div>

            <p class="footer-copy">&copy; 2025 YourBrand. All rights reserved.</p>
        </div>
    </footer>


  <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
  <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
  <script src="../js/landing_script.js"></script>


  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
    import {getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut}  from "https://www.gstatic.com/firebasejs/11.9.1/firebase-auth.js";
    import { getFirestore, doc, setDoc, getDoc, query, where, getDocs, collection } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-firestore.js";

    // Firebase Configuration
    const firebaseConfig = getFirebaseConfigForLanding();

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // ‚úÖ Register - Only for Users
    window.registerUser = async () => {
      const email = document.getElementById('registerEmail').value;
      const password = document.getElementById('registerPassword').value;
      const username = document.getElementById('registerUsername').value;

      if (!email || !password || !username) {
        alert("Please fill all fields.");
        return;
      }

      showLoader(); // Start spinner

      try {
        const userCred = await createUserWithEmailAndPassword(auth, email, password);

        // Store user data in Firestore
        await setDoc(doc(db, "users", userCred.user.uid), {
          email,
          username,
          password,
          role: "user",
          createdAt: new Date()
        });

        // alert("User registered successfully!");
        window.location.href = "user_dash.html"; // optional redirect
      } catch (error) {
        alert("Registration failed: " + error.message);
      }
    };

    // üîê Login - User (with Firebase Auth) OR Admin (via Firestore)
    window.loginUser = async (expectedRole) => {
      let email, password, employeeID;

      if (expectedRole === "admin") {
        email = document.getElementById('loginAdminEmail').value;
        password = document.getElementById('loginAdminPassword').value;
        employeeID = document.getElementById('loginAdminEmployeeID').value;
      } else {
        email = document.getElementById('loginUserEmail').value;
        password = document.getElementById('loginUserPassword').value;
      }

      showLoader(); // Show loader while processing

      try {
        if (expectedRole === "user") {
          // ‚úÖ Firebase Auth Login for Users
          const userCred = await signInWithEmailAndPassword(auth, email, password);
          const userDocRef = doc(db, "users", userCred.user.uid);
          const userDoc = await getDoc(userDocRef);

          if (!userDoc.exists()) {
            alert("No user record found in Firestore.");
            return;
          }

          const data = userDoc.data();

          // üîê Role Check
          if (data.role !== "user") {
            alert("Unauthorized access: Not a user account.");
            await signOut(auth);
            return;
          }

          // ‚úÖ Success
          window.location.href = "user_dash.html";
        } 
        
        else if (expectedRole === "admin") {
          // üîç Firestore Lookup for Admin (No Firebase Auth)
          const q = query(
            collection(db, "admins"),
            where("email", "==", email),
            where("password", "==", password),
            where("employeeID", "==", employeeID)
          );

          const querySnapshot = await getDocs(q);

          if (querySnapshot.empty) {
            alert("Invalid admin credentials.");
            return;
          }

          // ‚úÖ Success
          window.location.href = "dashboard.html";
        }
      } catch (err) {
        alert("Login failed: " + err.message);
      } finally {
        hideLoader(); // Always hide loader
      }
    };


  </script>


</body>
</html>